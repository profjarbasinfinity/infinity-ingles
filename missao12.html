<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InFinity | Miss√£o 12</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap');
        :root { --if-green: #2f9e41; --primary: #00df9a; --secondary: #2a5ff0; --bg: #f8fafc; --card-bg: #ffffff; --text: #1e293b; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); text-align: center; padding: 20px; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--card-bg); border-radius: 20px; padding: 30px; width: 100%; max-width: 500px; border: 1px solid #e2e8f0; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .video-wrapper { position: relative; padding-bottom: 177.78%; height: 0; border-radius: 12px; overflow: hidden; margin-bottom: 25px; background: #000; border: 2px solid var(--secondary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .word-display { font-size: 2.5rem; font-weight: 800; color: var(--secondary); margin: 20px 0; background: #f1f5f9; padding: 15px; border-radius: 12px; }
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; border: none; background: var(--primary); cursor: pointer; font-size: 2.2rem; margin: 0 auto; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .mic-btn.recording { background: #ff4b2b; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .status { margin-top: 20px; color: #64748b; font-weight: 600; }
        .btn-finish { display: none; width: 100%; padding: 18px; border: none; border-radius: 12px; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white; font-weight: 800; cursor: pointer; margin-top: 25px; }
    </style>
</head>
<body>
    <img src="logo-horizontal.jpg" alt="InFinity Logo" style="width:180px; margin-bottom:20px;">
    <div class="card">
        <div class="video-wrapper"><iframe src="https://www.youtube-nocookie.com/embed/n2VSL7V4wvQ" allowfullscreen></iframe></div>
        <h3 style="color: var(--secondary);">MISS√ÉO 12: O SOPRO DO TH</h3>
        <div id="target-word" class="word-display">THINK</div>
        <button id="mic-btn" class="mic-btn" onclick="startSpeech()">üé§</button>
        <div class="status" id="status">Aguardando microfone...</div>
        <div class="transcript" id="transcript"></div>
        <button id="finish-btn" class="btn-finish" onclick="completeMission()">ENCERRAR MISS√ÉO 12</button>
    </div>

    <script>
        const words = ["THINK", "THEY", "BIRTHDAY", "FATHER", "THROUGH"];
        let currentIdx = 0;
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';

        function startSpeech() { recognition.start(); document.getElementById('mic-btn').classList.add('recording'); document.getElementById('status').innerText = "Ouvindo..."; }

        recognition.onresult = (event) => {
            const result = event.results[0][0].transcript.toUpperCase();
            const target = words[currentIdx];
            document.getElementById('mic-btn').classList.remove('recording');
            if (result.includes(target)) {
                confetti({ particleCount: 50, spread: 50 });
                currentIdx++;
                if (currentIdx < words.length) {
                    document.getElementById('target-word').innerText = words[currentIdx];
                    document.getElementById('status').innerText = "‚úîÔ∏è Excelente! Pr√≥xima...";
                } else {
                    document.getElementById('target-word').innerText = "CONCLU√çDO!";
                    document.getElementById('mic-btn').style.display = "none";
                    document.getElementById('finish-btn').style.display = "block";
                }
            } else { document.getElementById('status').innerText = "‚ùå Tente novamente."; }
        };

        function completeMission() {
            localStorage.setItem('m12_complete', 'true');
            localStorage.setItem('ultima_conclusao', new Date().toLocaleDateString());
            
            const alunoData = JSON.parse(localStorage.getItem('aluno_infinity'));
            if (alunoData) {
                fetch("https://script.google.com/macros/s/AKfycbziLkmSI-S9wRb2lb8PTjyU0L4naMQfbtor0a3MGdkHaULM_CvwTxkQDq3ojgrqAnDX/exec", {
                    method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nome: alunoData.nome, turma: alunoData.turma, curso: alunoData.curso, email: alunoData.email, missao: "InFinity | Miss√£o 12" })
                });
            }
            setTimeout(() => { location.href = 'index.html'; }, 500);
        }
    </script>
</body>
</html>
