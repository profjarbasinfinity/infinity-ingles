<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InFinity | Missﾃ｣o 11</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap');
        :root { --if-green: #2f9e41; --primary: #00df9a; --secondary: #2a5ff0; --bg: #050816; --card-bg: #101630; --text: #ffffff; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .logo-img { width: 180px; margin: 20px 0; }
        .card { background: var(--card-bg); border-radius: 20px; padding: 20px; width: 100%; max-width: 600px; border: 1px solid #1e293b; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .video-wrapper { position: relative; padding-bottom: 177.78%; height: 0; border-radius: 12px; overflow: hidden; margin-bottom: 25px; background: #000; border: 2px solid var(--secondary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .task-title { color: var(--primary); font-weight: 600; margin-bottom: 10px; border-left: 4px solid var(--if-green); padding-left: 10px; }
        .quiz-item { margin-bottom: 40px; background: #161d3a; padding: 20px; border-radius: 15px; border: 1px solid #2a5ff044; }
        .eng-phrase { display: block; font-weight: 800; color: #fff; margin-bottom: 15px; font-size: 1.1rem; text-align: center; background: #0a1025; padding: 10px; border-radius: 8px; }
        .answer-zone { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; min-height: 50px; padding: 12px; border: 2px solid var(--secondary); border-radius: 10px; margin-bottom: 15px; background: rgba(0,0,0,0.3); }
        .word-pool { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .word-btn { padding: 8px 14px; background: #ffffff; color: #000; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; border: none; transition: 0.2s; }
        .btn-verify { width: 100%; padding: 20px; border: none; border-radius: 12px; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: #000; font-weight: 800; cursor: pointer; margin-top: 20px; font-size: 1.1rem; }
        #success-screen { display: none; position: fixed; inset: 0; background: var(--bg); flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <img src="logo-horizontal.jpg" alt="InFinity Logo" class="logo-img">
    <div class="card" id="quiz-card">
        <div class="video-wrapper">
            <iframe src="https://www.youtube-nocookie.com/embed/B88YDENvsxk" allowfullscreen></iframe>
        </div>
        <div class="task-title">MISSﾃグ 11: RETEXTUALIZAﾃﾃグ</div>
        <p style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 20px;">Escolha apenas os termos que formam uma adaptaﾃｧﾃ｣o natural:</p>
        <div id="quiz-container"></div>
        <button class="btn-verify" onclick="verifyFinalMission()">FINALIZAR MISSﾃグ 11</button>
    </div>
    <div id="success-screen">
        <h1 style="font-size: 5rem; margin: 0;">雌</h1>
        <h2 style="color: var(--primary); font-size: 2.2rem;">MISSﾃグ CONCLUﾃ好A!</h2>
        <button class="btn-verify" style="width:280px;" onclick="location.href='index.html'">VOLTAR AO MAPA</button>
    </div>

    <script>
        const missions = [
            { eng: "The old man lost his earpiece", pool: ['O', 'idoso', 'perdeu', 'seu', 'ponto', 'eletrﾃｴnico', 'velho', 'homem', 'pedaﾃｧo', 'de', 'orelha'], correct: 'O idoso perdeu seu ponto eletrﾃｴnico' },
            { eng: "She is so free-spirited!", pool: ['Ela', 'ﾃｩ', 'tﾃ｣o', 'independente', 'livre', 'de', 'espﾃｭrito'], correct: 'Ela ﾃｩ tﾃ｣o independente' },
            { eng: "The police officer took my driver's license", pool: ['O', 'policial', 'pegou', 'minha', 'habilitaﾃｧﾃ｣o', 'oficial', 'de', 'polﾃｭcia', 'licenﾃｧa', 'dirigir'], correct: 'O policial pegou minha habilitaﾃｧﾃ｣o' },
            { eng: "The businessman wore a baseball hat", pool: ['O', 'empresﾃ｡rio', 'usou', 'um', 'bonﾃｩ', 'homem', 'negﾃｳcios', 'chapﾃｩu', 'beisebol'], correct: 'O empresﾃ｡rio usou um bonﾃｩ' },
            { eng: "The delivery guy bought his spare tire at the city market", pool: ['O', 'entregador', 'comprou', 'seu', 'estepe', 'na', 'feira', 'rapaz', 'entregas', 'pneu', 'sobressalente', 'mercado', 'cidade'], correct: 'O entregador comprou seu estepe na feira' }
        ];

        function shuffle(array) { return array.sort(() => Math.random() - 0.5); }

        function init() {
            const container = document.getElementById('quiz-container');
            missions.forEach((m, idx) => {
                const div = document.createElement('div');
                div.className = 'quiz-item';
                div.innerHTML = `<span class="eng-phrase">${m.eng}</span><div class="answer-zone" id="ans-${idx}"></div><div class="word-pool" id="pool-${idx}">${shuffle([...m.pool]).map(w => `<button class="word-btn" onclick="toggleWord(this, ${idx})">${w}</button>`).join('')}</div>`;
                container.appendChild(div);
            });
        }

        function toggleWord(btn, idx) {
            const ans = document.getElementById(`ans-${idx}`);
            const pool = document.getElementById(`pool-${idx}`);
            if (btn.parentElement === pool) ans.appendChild(btn); else pool.appendChild(btn);
        }

        function verifyFinalMission() {
            let win = true;
            missions.forEach((m, idx) => {
                const userText = Array.from(document.getElementById(`ans-${idx}`).children).map(b => b.innerText).join(' ').toLowerCase();
                if (userText !== m.correct.toLowerCase()) win = false;
            });

            if (win) {
                localStorage.setItem('m11_complete', 'true');
                localStorage.setItem('ultima_conclusao', new Date().toLocaleDateString());
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
                document.getElementById('quiz-card').style.display = 'none';
                document.getElementById('success-screen').style.display = 'flex';

                const alunoData = JSON.parse(localStorage.getItem('aluno_infinity'));
                if (alunoData) {
                    fetch("https://script.google.com/macros/s/AKfycbziLkmSI-S9wRb2lb8PTjyU0L4naMQfbtor0a3MGdkHaULM_CvwTxkQDq3ojgrqAnDX/exec", {
                        method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ nome: alunoData.nome, turma: alunoData.turma, curso: alunoData.curso, email: alunoData.email, missao: "InFinity | Missﾃ｣o 11" })
                    });
                }
            } else {
                alert("Verifique se as traduﾃｧﾃｵes estﾃ｣o naturais e completas!");
            }
        }
        init();
    </script>
</body>
</html>
