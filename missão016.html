<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InFinity | Miss√£o 16</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap');
        :root { --primary: #00df9a; --secondary: #2a5ff0; --bg: #050816; --card-bg: #101630; }
        
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: white; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .card { background: var(--card-bg); border-radius: 20px; padding: 25px; width: 100%; max-width: 600px; border: 1px solid #1e293b; }
        
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; border-radius: 12px; overflow: hidden; margin-bottom: 20px; border: 1px solid var(--secondary); }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .analysis-box { background: #161d3a; padding: 15px; border-radius: 15px; margin-bottom: 15px; border-left: 5px solid var(--primary); }
        .term-title { font-weight: 800; color: var(--primary); font-size: 1rem; display: block; }
        .term-subtitle { font-size: 0.8rem; color: #94a3b8; display: block; margin-bottom: 10px; }
        
        .tech-options { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .tech-btn { background: #0a1025; border: 1px solid #4a5568; color: #94a3b8; padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; transition: 0.2s; }
        .tech-btn.selected { background: var(--secondary); color: white; border-color: white; }

        /* Estilos do Texto de Clique */
        .clickable-text { line-height: 2; font-size: 1.1rem; text-align: justify; background: #161d3a; padding: 20px; border-radius: 12px; margin: 20px 0; }
        .word { cursor: pointer; padding: 2px 4px; border-radius: 4px; transition: 0.3s; border-bottom: 1px dashed #4a5568; }
        .word:hover { background: #2a5ff044; }
        .word.found { background: var(--primary); color: #000; font-weight: bold; border-bottom: none; }

        input[type="text"] { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #4a5568; background: #0a1025; color: white; }

        .section { display: none; }
        .section.active { display: block; }

        .btn-check { width: 100%; padding: 18px; border: none; border-radius: 12px; background: linear-gradient(45deg, var(--primary), var(--secondary)); color: #000; font-weight: 800; cursor: pointer; margin-top: 20px; }
        #success-screen { display: none; position: fixed; inset: 0; background: var(--bg); flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
    </style>
</head>
<body>

    <img src="logo-horizontal.jpg" alt="Logo" style="width:180px; margin: 20px;">

    <div class="card" id="main-card">
        <div class="video-wrapper">
            <iframe src="https://www.youtube.com/embed/I4WCM84qjIY" allowfullscreen></iframe>
        </div>

        <div id="step1" class="section active">
            <h3 style="color: var(--primary); text-align: center;">ETAPA 1: FUN√á√ïES DO PRESENTE</h3>
            <div id="quiz-area"></div>
            <button class="btn-check" onclick="validateStep1()">PR√ìXIMA ETAPA</button>
        </div>

        <div id="step2" class="section">
            <h3 style="color: var(--primary); text-align: center;">ETAPA 2: IDENTIFIQUE OS VERBOS</h3>
            <p style="font-size: 0.8rem; text-align: center; color: #94a3b8;">Clique nos 6 verbos na forma base que aparecem no texto abaixo:</p>
            <div class="clickable-text" id="text-container"></div>
            <p id="counter" style="text-align: center; font-weight: bold; color: var(--primary);">Encontrados: 0 / 6</p>
            <button class="btn-check" id="btn-goto-step3" style="display:none" onclick="startStep3()">TRADUZIR VERBOS</button>
        </div>

        <div id="step3" class="section">
            <h3 style="color: var(--primary); text-align: center;">ETAPA 3: TRADU√á√ÉO E SENTIDO</h3>
            <div id="translation-fields">
                <label>Value:</label> <input type="text" value="Valorizamos" disabled style="opacity: 0.6">
                <label>Lose:</label> <input type="text" id="t-lose" placeholder="Tradu√ß√£o de 'lose'">
                <label>Reflect:</label> <input type="text" id="t-reflect" placeholder="Tradu√ß√£o de 'reflect'">
                <label>Gain:</label> <input type="text" id="t-gain" placeholder="Tradu√ß√£o de 'gain'">
                <label>Question:</label> <input type="text" id="t-question" placeholder="Tradu√ß√£o de 'question'">
                <label>Understand:</label> <input type="text" id="t-understand" placeholder="Tradu√ß√£o de 'understand'">
            </div>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #1e293b;">
            <p style="font-size: 0.9rem;">Do que trata esse texto?</p>
            <input type="text" id="interpretation" placeholder="Sua resposta aqui...">
            <button class="btn-check" onclick="finishMission()">CONCLUIR MISS√ÉO</button>
        </div>
    </div>

    <div id="success-screen">
        <h1 style="font-size: 5rem;">üß†</h1>
        <h2 style="color: var(--primary);">MISS√ÉO CONCLU√çDA!</h2>
        <p>Voc√™ dominou a forma base e a interpreta√ß√£o de texto no presente!</p>
        <button class="btn-check" style="width: 250px;" onclick="location.href='index.html'">VOLTAR AO MAPA</button>
    </div>

    <script>
        const MISSION_ID = 16;
        const PREVIOUS_MISSION_ID = 15;
        const SCRIPT_URL = 'SUA_URL_DO_GOOGLE_APPS_SCRIPT_AQUI';

        // 1) Dados fornecidos para Etapa 1
        const analysisData = [
            { term: "Scientists affirm", subtitle: "Cientistas afirmam (Fato cient√≠fico)", correct: 'Validade Cont√≠nua' },
            { term: "Dogs understand social signals", subtitle: "C√£es entendem sinais sociais (Capacidade geral da esp√©cie)", correct: 'Generaliza√ß√£o' },
            { term: "Dogs recognize human emotions", subtitle: "C√£es reconhecem (Capacidade geral da esp√©cie)", correct: 'Generaliza√ß√£o' },
            { term: "Dogs respond calmly to stressful situations", subtitle: "C√£es respondem calmamente a situa√ß√µes estressantes (Comportamento habitual)", correct: 'Regularidade' }
        ];

        let userChoicesStep1 = Array(analysisData.length).fill(null);
        let foundVerbs = new Set();
        const targetVerbs = ['value', 'lose', 'reflect', 'gain', 'question', 'understand'];

        function init() {
            // Render Etapa 1
            const area = document.getElementById('quiz-area');
            area.innerHTML = analysisData.map((item, qIdx) => `
                <div class="analysis-box">
                    <span class="term-title">${item.term}</span>
                    <span class="term-subtitle">${item.subtitle}</span>
                    <div class="tech-options">
                        ${['Regularidade', 'Generaliza√ß√£o', 'Validade Cont√≠nua', 'Organiza√ß√£o Social do Tempo'].map(t => `
                            <div class="tech-btn" id="btn-${qIdx}-${t}" onclick="selectStep1(${qIdx}, '${t}')">${t}</div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // Render Etapa 2 (Texto)
            const text = "We value things when we lose them and consequently reflect on our bad decisions. We gain maturity when we question our priorities and understand the effects of time on our experiences.";
            const container = document.getElementById('text-container');
            container.innerHTML = text.split(' ').map(word => {
                const cleanWord = word.replace(/[.,]/g, '').toLowerCase();
                if (targetVerbs.includes(cleanWord)) {
                    return `<span class="word" onclick="handleWordClick(this, '${cleanWord}')">${word}</span>`;
                }
                return `<span>${word}</span>`;
            }).join(' ');
        }

        function selectStep1(qIdx, tech) {
            ['Regularidade', 'Generaliza√ß√£o', 'Validade Cont√≠nua', 'Organiza√ß√£o Social do Tempo'].forEach(t => 
                document.getElementById(`btn-${qIdx}-${t}`).classList.remove('selected'));
            userChoicesStep1[qIdx] = tech;
            document.getElementById(`btn-${qIdx}-${tech}`).classList.add('selected');
        }

        function validateStep1() {
            if (userChoicesStep1.every((choice, idx) => choice === analysisData[idx].correct)) {
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step2').classList.add('active');
                confetti({ particleCount: 50 });
            } else {
                alert("Verifique suas associa√ß√µes de fun√ß√£o. Revise o v√≠deo se necess√°rio!");
            }
        }

        function handleWordClick(el, word) {
            if (!el.classList.contains('found')) {
                el.classList.add('found');
                foundVerbs.add(word);
                document.getElementById('counter').innerText = `Encontrados: ${foundVerbs.size} / 6`;
                if (foundVerbs.size === 6) {
                    document.getElementById('btn-goto-step3').style.display = 'block';
                    confetti({ particleCount: 30 });
                }
            }
        }

        function startStep3() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
        }

        async function finishMission() {
            const interpretation = document.getElementById('interpretation').value.toLowerCase();
            
            // Valida√ß√£o de seguran√ßa simples: preencheu as tradu√ß√µes e cont√©m 'maturidade'
            const tFields = ['t-lose', 't-reflect', 't-gain', 't-question', 't-understand'];
            const allTranslated = tFields.every(id => document.getElementById(id).value.length > 2);

            if (!allTranslated) {
                alert("Por favor, preencha as tradu√ß√µes dos verbos.");
                return;
            }

            if (interpretation.includes('maturidade')) {
                // SUCESSO
                localStorage.setItem(`m${MISSION_ID}_complete`, 'true');
                localStorage.setItem('last_mission_date', new Date().getTime().toString());
                
                // Envio para Sheets
                const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
                fetch(SCRIPT_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', 
                    body: JSON.stringify({
                        nome: userData.nome, email: userData.email,
                        missao: MISSION_ID, status: 'Conclu√≠do'
                    }) 
                });

                confetti({ particleCount: 150, spread: 70 });
                document.getElementById('main-card').style.display = 'none';
                document.getElementById('success-screen').style.display = 'flex';
            } else {
                alert("Sua resposta sobre o texto precisa refletir o tema principal. Dica: Do que o texto diz que ganhamos ('gain')?");
            }
        }

        init();
    </script>
</body>
</html>