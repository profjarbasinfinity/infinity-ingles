<script>
    // 1. Verificação de Acesso
    (function() {
        const aluno = localStorage.getItem('aluno_infinity');
        const visitante = sessionStorage.getItem('visitante');
        if (!aluno && !visitante) {
            window.location.href = "login.html";
        }
    })();

    // 2. Geração do Mapa
    const totalMissions = 15;
    const grid = document.getElementById('grid');
    let completedCount = 0;

    if (grid) {
        for (let i = 1; i <= totalMissions; i++) {
            const missionId = i.toString().padStart(2, '0'); 
            const isCompleted = localStorage.getItem(`m${missionId}_complete`) === 'true';
            if(isCompleted) completedCount++;

            const node = document.createElement('div');
            node.className = `mission-node ${isCompleted ? 'completed' : ''}`;
            
            node.onclick = function() {
                const hoje = new Date().toLocaleDateString();
                const ultimaData = localStorage.getItem('ultima_conclusao');

                if (isCompleted || ultimaData !== hoje) {
                    window.location.href = `missao${missionId}.html`;
                } else {
                    alert("Uma missão por dia! Volte amanhã.");
                }
            };

            node.innerHTML = `<div class="node-circle">${i}</div><div class="mission-label">Missão ${missionId}</div>`;
            grid.appendChild(node);
        }
        const statusText = document.getElementById('status-text');
        if (statusText) statusText.innerText = `Progresso: ${completedCount} de ${totalMissions}`;
    }
</script>
